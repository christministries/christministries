<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noah's Ark - Telugu Voice Story</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 { color: #2c3e50; margin-bottom: 5px; text-align: center; }

        /* Status Bar for Voice Debugging */
        #voice-status {
            font-size: 0.9rem;
            margin-bottom: 20px;
            padding: 5px 15px;
            border-radius: 20px;
            background-color: #e0e0e0;
            color: #555;
        }
        .status-ok { background-color: #d4edda !important; color: #155724 !important; border: 1px solid #c3e6cb; }
        .status-err { background-color: #f8d7da !important; color: #721c24 !important; border: 1px solid #f5c6cb; }

        #story-canvas {
            background-color: #ffffff;
            width: 900px;
            max-width: 100%;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #image-stage {
            height: 450px;
            background-color: #222;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #story-image {
            width: 100%;
            height: 100%;
            object-fit: contain; 
        }

        #caption-area {
            padding: 25px;
            text-align: center;
            min-height: 150px;
        }

        #telugu-caption {
            font-size: 1.4rem;
            color: #2c3e50;
            font-weight: 600;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        #english-sub {
            font-size: 1rem;
            color: #7f8c8d;
            font-style: italic;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
        }

        button {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.95); }

        #start-btn { background-color: #28a745; color: white; }
        #next-btn { background-color: #007bff; color: white; }
        #next-btn:disabled { background-color: #ccc; cursor: not-allowed; }

    </style>
</head>
<body>

    <h1>Noah's Ark (నోవహు ఓడ)</h1>
    <div id="voice-status">Checking for Telugu Voice Support...</div>

    <div id="story-canvas">
        <div id="image-stage">
            <img id="story-image" src="image_8.png" alt="Story Scene">
        </div>
        <div id="caption-area">
            <div id="telugu-caption">కథ వినడానికి 'Start Story' క్లిక్ చేయండి.</div>
            <div id="english-sub">Click 'Start Story' to listen to the narration.</div>
        </div>
    </div>

    <div class="controls">
        <button id="start-btn" onclick="startStory()">Start Story ▶</button>
        <button id="next-btn" onclick="nextScene()" disabled>Next Scene ➡</button>
    </div>

    <script>
        // STORY DATA
        const storyData = [
            {
                image: "image_4.png",
                // Split text into array for smoother reading
                teluguSentences: [
                    "పూర్వకాలంలో, భూమిపై మనుషుల పాపం పెరిగినప్పుడు దేవుడు వారిని చూసి దుఃఖించాడు.",
                    "కానీ నోవహు అనే ఒక నీతిమంతుడు దేవుని దృష్టిలో దయ పొందాడు.",
                    "దేవుడు నోవహుకు రాబోయే జలప్రళయం గురించి హెచ్చరించి, ఒక పెద్ద ఓడను కట్టమని ఆజ్ఞాపించాడు.",
                    "నోవహు దేవునికి భయపడి, తన కుమారులతో కలిసి ఆ గొప్ప ఓడను సిద్ధం చేశాడు."
                ],
                english: "God warned righteous Noah to build a massive ark to save his family. Noah obediently built it in the desert."
            },
            {
                image: "image_5.png",
                teluguSentences: [
                    "ఓడ నిర్మాణం పూర్తయిన తర్వాత, దేవుడు నోవహును ఓడలోకి వెళ్ళమని చెప్పాడు.",
                    "అద్భుతమైన రీతిలో, అన్ని రకాల జంతువులు మరియు పక్షులు జంటలు జంటలుగా ఓడలోకి వచ్చాయి.",
                    "నోవహు కుటుంబం లోపలికి వెళ్ళిన తరువాత, దేవుడే స్వయంగా ఓడ తలుపును మూసివేశాడు."
                ],
                english: "Animals miraculously arrived two by two and entered the ark peacefully. God shut the door behind them."
            },
            {
                image: "image_6.png",
                teluguSentences: [
                    "నలభై పగలు మరియు నలభై రాత్రులు భయంకరమైన వర్షం భూమిపై కురిసింది.",
                    "వరద నీరు పెరిగి, ఎత్తైన పర్వతాలను కూడా ముంచేసింది.",
                    "కానీ, ఆ భయంకరమైన తుఫాను మధ్యలో, నోవహు ఓడ సురక్షితంగా నీటిపై తేలియాడింది."
                ],
                english: "Torrential rain fell for 40 days. But Noah and those in the ark floated safely amidst the storm."
            },
            {
                image: "image_7.png",
                teluguSentences: [
                    "వర్షం ఆగి, నీరు తగ్గిన తర్వాత, నోవహు ఒక పావురాన్ని బయటకు పంపాడు.",
                    "సాయంకాలానికి ఆ పావురం ఒక పచ్చి ఒలీవ ఆకుతో తిరిగి వచ్చింది.",
                    "అది చూసి నోవహుకు భూమిపై నీరు తగ్గిపోయిందని తెలిసింది."
                ],
                english: "The rain stopped. A dove returned with an olive leaf, proving life was returning."
            },
            {
                image: "image_8.png",
                teluguSentences: [
                    "నోవహు మరియు అతని కుటుంబం ఓడ నుండి బయటకు వచ్చారు.",
                    "దేవుడు వారిని ఆశీర్వదించి, ఇకపై ఎన్నడూ జలప్రళయమును పంపనని వాగ్దానం చేశాడు.",
                    "దీనికి గుర్తుగా, దేవుడు ఆకాశంలో ఇంద్రధనస్సును ఉంచాడు."
                ],
                english: "God blessed them and promised never to flood the earth again, placing a rainbow as a sign."
            }
        ];

        // VARIABLES
        let currentSceneIndex = 0;
        let sentenceIndex = 0;
        const synth = window.speechSynthesis;
        
        const teluguCaption = document.getElementById('telugu-caption');
        const englishSub = document.getElementById('english-sub');
        const storyImage = document.getElementById('story-image');
        const startBtn = document.getElementById('start-btn');
        const nextBtn = document.getElementById('next-btn');
        const voiceStatus = document.getElementById('voice-status');

        let selectedVoice = null;

        // 1. VOICE LOADING LOGIC
        function loadVoices() {
            const voices = synth.getVoices();
            // Look for Telugu
            const teVoice = voices.find(v => v.lang.includes('te'));
            
            if (teVoice) {
                selectedVoice = teVoice;
                voiceStatus.textContent = "✅ Telugu Voice Active: " + teVoice.name;
                voiceStatus.className = "status-ok";
            } else {
                // If no Telugu, find any Indian English voice or default
                const inVoice = voices.find(v => v.lang.includes('IN')) || voices[0];
                selectedVoice = inVoice;
                voiceStatus.textContent = "⚠️ No Telugu Voice found on device. Using: " + (inVoice ? inVoice.name : "Default");
                voiceStatus.className = "status-err";
            }
        }

        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = loadVoices;
        }
        loadVoices();

        // 2. SPEAKING LOGIC (Sentence by Sentence)
        function speakSentenceArray(sentences) {
            if (sentenceIndex >= sentences.length) {
                // All sentences in this scene finished
                if (currentSceneIndex < storyData.length - 1) {
                    nextBtn.disabled = false;
                    nextBtn.textContent = "Next Scene ➡";
                } else {
                    nextBtn.textContent = "Story Finished";
                }
                return;
            }

            // Update text on screen to match what is being spoken
            teluguCaption.textContent = sentences[sentenceIndex];
            
            const utterThis = new SpeechSynthesisUtterance(sentences[sentenceIndex]);
            utterThis.lang = 'te-IN'; // Force Language Tag
            if (selectedVoice) {
                utterThis.voice = selectedVoice;
            }
            utterThis.rate = 0.9;
            utterThis.pitch = 1.0;

            utterThis.onend = function() {
                sentenceIndex++;
                speakSentenceArray(sentences); // Recursive call for next sentence
            };

            synth.speak(utterThis);
        }

        // 3. SCENE CONTROL
        function loadScene(index) {
            if (index >= storyData.length) {
                return;
            }
            
            // Reset for new scene
            sentenceIndex = 0;
            synth.cancel();
            nextBtn.disabled = true;
            nextBtn.textContent = "Playing Audio...";

            const scene = storyData[index];

            // Update Image and Static Text
            storyImage.src = scene.image;
            englishSub.textContent = scene.english;

            // Start Speaking
            speakSentenceArray(scene.teluguSentences);
        }

        function startStory() {
            startBtn.style.display = 'none';
            nextBtn.style.display = 'block';
            currentSceneIndex = 0;
            loadScene(currentSceneIndex);
        }

        function nextScene() {
            currentSceneIndex++;
            loadScene(currentSceneIndex);
        }

    </script>
</body>
</html>
